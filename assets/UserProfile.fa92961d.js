import{Q as O,a as G}from"./QItem.9b8fe882.js";import{C as X,B as R,r as F,E as Q,F as C,G as y,H as p,I as c,aw as Y,J as S,av as V,S as B,aK as q,Q as J,c as A,bv as ee,D as ae,K as oe,O as te}from"./index.64cc4690.js";import{Q as le}from"./QList.fc8ece6d.js";import{Q as se}from"./QPage.a7e31bdc.js";import{Q as W}from"./QForm.1039961a.js";import{u as D}from"./notify.hook.f33a760a.js";const k=()=>{const{onUpdateProfile:s,onUpdateEmail:i,onUpdatePassword:o,onUploadProfile:f}=X();return{isValidEmail:a=>/^(?=[a-zA-Z0-9@._%+-]{6,254}$)[a-zA-Z0-9._%+-]{1,64}@(?:[a-zA-Z0-9-]{1,63}\.){1,8}[a-zA-Z]{2,63}$/.test(a)||`La direcci\xF3n de correo "${a}" no es v\xE1lida`,updateDisplayName:async a=>{await s({displayName:a})},updateEmail:async a=>{await i(a)},updatePassword:async a=>{await o(a)},uploadPhoto:async a=>{await f(a)}}},re=p("div",{class:"text-h6"},"Correo electr\xF3nico",-1),ne=p("div",{class:"text-h6"},"Nombre de perfil",-1),de=R({__name:"EmailDisplayName",props:["displayName","email"],setup(s){const i=s,{isValidEmail:o,updateDisplayName:f,updateEmail:r}=k(),{error:t,ok:v}=D(),m=F(!1),u=F(!1),a=F({displayName:i.displayName,email:i.email}),w=async()=>{try{if(u.value=!0,a.value.email===i.email)throw new Error('El "Correo electr\xF3nico" no ha sido modificado');await r(a.value.email),v(`El correo de ${a.value.email} ha sido actualizado.`)}catch(b){t(q[b.code]||b.message)}finally{u.value=!1}},_=async()=>{try{if(u.value=!0,a.value.displayName===i.displayName)throw new Error('El "Nombre de perfil" no ha sido modificado');await f(a.value.displayName),v("Nombre del perfil de usuario actualizado.")}catch(b){t(q[b.code]||b.message)}finally{u.value=!1}},U=()=>{m.value?w():_()};return(b,e)=>(Q(),C(W,{class:"q-gutter-md",onSubmit:U},{default:y(()=>[p("div",null,[re,p("div",null,[c(Y,{onChange:e[0]||(e[0]=n=>m.value=!m.value),modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=n=>m.value=n),"checked-icon":"check",color:"red",label:"Editar Correo","unchecked-icon":"clear"},null,8,["modelValue"])]),p("div",null,[c(V,{modelValue:a.value.email,"onUpdate:modelValue":e[2]||(e[2]=n=>a.value.email=n),label:"Email de Usuario*",disable:!m.value,"lazy-rules":"",rules:[S(o)]},null,8,["modelValue","disable","rules"])])]),p("div",null,[ne,c(V,{modelValue:a.value.displayName,"onUpdate:modelValue":e[3]||(e[3]=n=>a.value.displayName=n),modelModifiers:{trim:!0},filled:"",label:"Nombre",hint:"Nombre y apellidos del usuario",disable:m.value,"lazy-rules":"",rules:[n=>n.length>3||"Introduzca por lo menos 4 caracteres"]},null,8,["modelValue","disable","rules"])]),c(B,{loading:u.value,disable:u.value,label:"Actualizar",type:"submit",color:"primary"},null,8,["loading","disable"])]),_:1}))}}),ie=p("div",{class:"text-h6"},"Cambio de contrase\xF1a",-1),ue=R({__name:"PasswordChange",setup(s){const{error:i,ok:o}=D(),{updatePassword:f}=k(),r=F(!1),t=F({password:"",passwordRepeat:""}),v=a=>a===t.value.password||"Las contrase\xF1as no coinciden",m=()=>{t.value.passwordRepeat="",t.value.password=""},u=async()=>{try{if(r.value=!0,t.value.password.length)await f(t.value.password),o("Cambio de contrase\xF1a realizada");else throw new Error("Debe introducir una contrase\xF1a nueva")}catch(a){i(q[a.code]||a.message)}finally{r.value=!1}};return(a,w)=>(Q(),C(W,{class:"q-gutter-md",onSubmit:u,onReset:m},{default:y(()=>[ie,c(V,{modelValue:t.value.password,"onUpdate:modelValue":w[0]||(w[0]=_=>t.value.password=_),modelModifiers:{trim:!0},outlined:"",label:"Nueva contrase\xF1a*",rules:[_=>_.length<1||_.length>5||"La contrase\xF1a debe de tener por lo menos 6 caracteres"],type:"password"},{prepend:y(()=>[c(J,{name:"password",color:"teal"})]),_:1},8,["modelValue","rules"]),c(V,{modelValue:t.value.passwordRepeat,"onUpdate:modelValue":w[1]||(w[1]=_=>t.value.passwordRepeat=_),modelModifiers:{trim:!0},outlined:"",label:"Repita contrase\xF1a*",type:"password",rules:[v]},{prepend:y(()=>[c(J,{name:"password",color:"teal"})]),_:1},8,["modelValue","rules"]),p("div",null,[c(B,{loading:r.value,disable:r.value,label:"Cambiar",type:"submit",color:"primary"},null,8,["loading","disable"]),c(B,{label:"Borrar",type:"reset",color:"primary",flat:"",class:"q-ml-sm"})])]),_:1}))}});function g(s){return typeof s=="function"?s:()=>s}const ce={url:[Function,String],method:{type:[Function,String],default:"POST"},fieldName:{type:[Function,String],default:()=>s=>s.name},headers:[Function,Array],formFields:[Function,Array],withCredentials:[Function,Boolean],sendRaw:[Function,Boolean],batch:[Function,Boolean],factory:Function},me=["factory-failed","uploaded","failed","uploading"];function pe({props:s,emit:i,helpers:o}){const f=F([]),r=F([]),t=F(0),v=A(()=>({url:g(s.url),method:g(s.method),headers:g(s.headers),formFields:g(s.formFields),fieldName:g(s.fieldName),withCredentials:g(s.withCredentials),sendRaw:g(s.sendRaw),batch:g(s.batch)})),m=A(()=>t.value>0),u=A(()=>r.value.length>0);let a;function w(){f.value.forEach(e=>{e.abort()}),r.value.length>0&&(a=!0)}function _(){const e=o.queuedFiles.value.slice(0);o.queuedFiles.value=[],v.value.batch(e)?U(e):e.forEach(n=>{U([n])})}function U(e){if(t.value++,typeof s.factory!="function"){b(e,{});return}const n=s.factory(e);if(!n)i("factory-failed",new Error("QUploader: factory() does not return properly"),e),t.value--;else if(typeof n.catch=="function"&&typeof n.then=="function"){r.value.push(n);const x=d=>{o.isAlive()===!0&&(r.value=r.value.filter(h=>h!==n),r.value.length===0&&(a=!1),o.queuedFiles.value=o.queuedFiles.value.concat(e),e.forEach(h=>{o.updateFileStatus(h,"failed")}),i("factory-failed",d,e),t.value--)};n.then(d=>{a===!0?x(new Error("Aborted")):o.isAlive()===!0&&(r.value=r.value.filter(h=>h!==n),b(e,d))}).catch(x)}else b(e,n||{})}function b(e,n){const x=new FormData,d=new XMLHttpRequest,h=(l,N)=>n[l]!==void 0?g(n[l])(N):v.value[l](N),I=h("url",e);if(!I){console.error("q-uploader: invalid or no URL specified"),t.value--;return}const L=h("formFields",e);L!==void 0&&L.forEach(l=>{x.append(l.name,l.value)});let T=0,M=0,z=0,j=0,Z;d.upload.addEventListener("progress",l=>{if(Z===!0)return;const N=Math.min(j,l.loaded);o.uploadedSize.value+=N-z,z=N;let P=z-M;for(let $=T;P>0&&$<e.length;$++){const E=e[$];if(P>E.size)P-=E.size,T++,M+=E.size,o.updateFileStatus(E,"uploading",E.size);else{o.updateFileStatus(E,"uploading",P);return}}},!1),d.onreadystatechange=()=>{d.readyState<4||(d.status&&d.status<400?(o.uploadedFiles.value=o.uploadedFiles.value.concat(e),e.forEach(l=>{o.updateFileStatus(l,"uploaded")}),i("uploaded",{files:e,xhr:d})):(Z=!0,o.uploadedSize.value-=z,o.queuedFiles.value=o.queuedFiles.value.concat(e),e.forEach(l=>{o.updateFileStatus(l,"failed")}),i("failed",{files:e,xhr:d})),t.value--,f.value=f.value.filter(l=>l!==d))},d.open(h("method",e),I),h("withCredentials",e)===!0&&(d.withCredentials=!0);const H=h("headers",e);H!==void 0&&H.forEach(l=>{d.setRequestHeader(l.name,l.value)});const K=h("sendRaw",e);e.forEach(l=>{o.updateFileStatus(l,"uploading",0),K!==!0&&x.append(h("fieldName",l),l,l.name),l.xhr=d,l.__abort=()=>{d.abort()},j+=l.size}),i("uploading",{files:e,xhr:d}),f.value.push(d),K===!0?d.send(new Blob(e)):d.send(x)}return{isUploading:m,isBusy:u,abort:w,upload:_}}var fe={name:"QUploader",props:ce,emits:me,injectPlugin:pe},ve=ee(fe);const he=R({__name:"PhotoUser",setup(s){const{uploadPhoto:i}=k(),{error:o,ok:f}=D(),r=F(15e4),t=u=>{o(`${u.length} imagen(es) no pasa(n) las restricciones: 1. Tama\xF1o m\xE1ximo (${r.value} bytes)`)},v=u=>{if(u&&u.length)try{u.forEach(async a=>{await i(a)}),f("Foto de imagen subida")}catch(a){o(q[a.code]||a.message)}},m=u=>{o(u.message)};return(u,a)=>(Q(),C(ve,{label:`Foto de perfil (max: ${r.value} bytes)`,onFailed:m,onRejected:t,factory:v,accept:"image/jpeg","max-file-size":r.value},null,8,["label","max-file-size"]))}}),ye=p("h1",{class:"text-h5"},"Perfil de usuario",-1),_e={class:"q-pa-md row"},be={class:"col-12 col-sm-6"},we={class:"q-pa-md"},ge={class:"col-12 col-sm-6 q-pa-md"},Fe={class:"q-mb-sm"},xe={class:"q-mt-xl"},Ee=p("div",{class:"text-h6"},"Foto de perfil del usuario",-1),Ne=["src"],Ue=te("Imagen del perfil"),Ce=R({__name:"UserProfile",setup(s){const{user:i}=ae(X());return(o,f)=>(Q(),C(se,{padding:""},{default:y(()=>{var r,t;return[ye,p("div",_e,[p("div",be,[p("div",we,[c(de,{displayName:(r=S(i))==null?void 0:r.displayName,email:(t=S(i))==null?void 0:t.email},null,8,["displayName","email"])])]),p("div",ge,[p("div",Fe,[c(ue)]),p("div",xe,[Ee,c(le,null,{default:y(()=>[c(O,null,{default:y(()=>[c(he)]),_:1}),c(O,null,{default:y(()=>[c(G,{avatar:""},{default:y(()=>[c(oe,null,{default:y(()=>{var v,m;return[p("img",{src:(m=(v=S(i))==null?void 0:v.photoURL)!=null?m:"https://cdn.quasar.dev/img/boy-avatar.png"},null,8,Ne)]}),_:1})]),_:1}),c(G,null,{default:y(()=>[Ue]),_:1})]),_:1})]),_:1})])])])]}),_:1}))}});export{Ce as default};
